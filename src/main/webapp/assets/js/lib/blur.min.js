(function(a){a.fn.blurjs=function(f){var e=document.createElement("canvas");var d=false;var b=(a(this).selector).replace(/[^a-zA-Z0-9]/g,"");if(!e.getContext){return}f=a.extend({source:"body",radius:5,overlay:"",offset:{x:0,y:0},optClass:"",cache:false,cacheKeyPrefix:"blurjs-",draggable:false,debug:false},f);var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function g(ar,aq,ap,ao,am,al){if(isNaN(al)||al<1){return}al|=0;var ak=ar.getContext("2d");var ai;try{try{ai=ak.getImageData(aq,ap,ao,am)}catch(an){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");ai=ak.getImageData(aq,ap,ao,am)}catch(an){alert("Cannot access local image");throw new Error("unable to access local image data: "+an)}}}catch(an){alert("Cannot access image");throw new Error("unable to access image data: "+an)}var ah=ai.data;var T,S,aj,ac,H,K,E,B,C,N,F,O,M,Q,V,I,D,J,L,P;var ag=al+al+1;var af=ao<<2;var ae=ao-1;var ad=am-1;var ab=al+1;var aa=ab*(ab+1)/2;var Z=new h();var Y=Z;for(aj=1;aj<ag;aj++){Y=Y.next=new h();if(aj==ab){var X=Y}}Y.next=Z;var W=null;var U=null;E=K=0;var R=c[al];var G=i[al];for(S=0;S<am;S++){Q=V=I=B=C=N=0;F=ab*(D=ah[K]);O=ab*(J=ah[K+1]);M=ab*(L=ah[K+2]);B+=aa*D;C+=aa*J;N+=aa*L;Y=Z;for(aj=0;aj<ab;aj++){Y.r=D;Y.g=J;Y.b=L;Y=Y.next}for(aj=1;aj<ab;aj++){ac=K+((ae<aj?ae:aj)<<2);B+=(Y.r=(D=ah[ac]))*(P=ab-aj);C+=(Y.g=(J=ah[ac+1]))*P;N+=(Y.b=(L=ah[ac+2]))*P;Q+=D;V+=J;I+=L;Y=Y.next}W=Z;U=X;for(T=0;T<ao;T++){ah[K]=(B*R)>>G;ah[K+1]=(C*R)>>G;ah[K+2]=(N*R)>>G;B-=F;C-=O;N-=M;F-=W.r;O-=W.g;M-=W.b;ac=(E+((ac=T+al+1)<ae?ac:ae))<<2;Q+=(W.r=ah[ac]);V+=(W.g=ah[ac+1]);I+=(W.b=ah[ac+2]);B+=Q;C+=V;N+=I;W=W.next;F+=(D=U.r);O+=(J=U.g);M+=(L=U.b);Q-=D;V-=J;I-=L;U=U.next;K+=4}E+=ao}for(T=0;T<ao;T++){V=I=Q=C=N=B=0;K=T<<2;F=ab*(D=ah[K]);O=ab*(J=ah[K+1]);M=ab*(L=ah[K+2]);B+=aa*D;C+=aa*J;N+=aa*L;Y=Z;for(aj=0;aj<ab;aj++){Y.r=D;Y.g=J;Y.b=L;Y=Y.next}H=ao;for(aj=1;aj<=al;aj++){K=(H+T)<<2;B+=(Y.r=(D=ah[K]))*(P=ab-aj);C+=(Y.g=(J=ah[K+1]))*P;N+=(Y.b=(L=ah[K+2]))*P;Q+=D;V+=J;I+=L;Y=Y.next;if(aj<ad){H+=ao}}K=T;W=Z;U=X;for(S=0;S<am;S++){ac=K<<2;ah[ac]=(B*R)>>G;ah[ac+1]=(C*R)>>G;ah[ac+2]=(N*R)>>G;B-=F;C-=O;N-=M;F-=W.r;O-=W.g;M-=W.b;ac=(T+(((ac=S+ab)<ad?ac:ad)*ao))<<2;B+=(Q+=(W.r=ah[ac]));C+=(V+=(W.g=ah[ac+1]));N+=(I+=(W.b=ah[ac+2]));W=W.next;F+=(D=U.r);O+=(J=U.g);M+=(L=U.b);Q-=D;V-=J;I-=L;U=U.next;K+=ao}}ak.putImageData(ai,aq,ap)}function h(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}return this.each(function(){var j=a(this);var m=a(f.source);var l=(m.css("backgroundImage")).replace(/"/g,"").replace(/url\(|\)$/ig,"");ctx=e.getContext("2d");tempImg=new Image();tempImg.onload=function(){if(!d){e.style.display="none";e.width=tempImg.width;e.height=tempImg.height;ctx.drawImage(tempImg,0,0);g(e,0,0,e.width,e.height,f.radius);if(f.overlay!=false){ctx.beginPath();ctx.rect(0,0,tempImg.width,tempImg.width);ctx.fillStyle=f.overlay;ctx.fill()}var o=e.toDataURL();if(f.cache){try{if(f.debug){console.log("Cache Set")}localStorage.setItem(f.cacheKeyPrefix+b+"-"+l+"-data-image",o)}catch(p){console.log(p)}}}else{var o=tempImg.src}var q=m.css("backgroundAttachment");var n=(q=="fixed")?"":"-"+((j.offset().left)-(m.offset().left)-(f.offset.x))+"px -"+((j.offset().top)-(m.offset().top)-(f.offset.y))+"px";j.css({"background-image":'url("'+o+'")',"background-repeat":m.css("backgroundRepeat"),"background-position":n,"background-attachment":q});if(f.optClass!=false){j.addClass(f.optClass)}if(f.draggable){j.css({"background-attachment":"fixed","background-position":"0 0"});j.draggable()}};Storage.prototype.cacheChecksum=function(p){var o="";for(var n in p){var r=p[n];if(r.toString()=="[object Object]"){o+=((r.x).toString()+(r.y).toString()+",").replace(/[^a-zA-Z0-9]/g,"")}else{o+=(r+",").replace(/[^a-zA-Z0-9]/g,"")}}var q=this.getItem(f.cacheKeyPrefix+b+"-"+l+"-options-cache");if(q!=o){this.removeItem(f.cacheKeyPrefix+b+"-"+l+"-options-cache");this.setItem(f.cacheKeyPrefix+b+"-"+l+"-options-cache",o);if(f.debug){console.log("Settings Changed, Cache Emptied")}}};var k=null;if(f.cache){localStorage.cacheChecksum(f);k=localStorage.getItem(f.cacheKeyPrefix+b+"-"+l+"-data-image")}if(k!=null){if(f.debug){console.log("Cache Used")}d=true;tempImg.src=(k)}else{if(f.debug){console.log("Source Used")}tempImg.src=l}})}})(jQuery);